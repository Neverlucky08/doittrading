{"generator":"Code Snippets v3.6.8","date_created":"2025-07-19 07:03","snippets":[{"id":14,"name":"DoItTrading MQL5 Reviews ACF","code":"\/\/ Mostrar reviews de MQL5 desde ACF\nadd_filter('woocommerce_product_tabs', 'doittrading_custom_reviews_tab', 98);\nfunction doittrading_custom_reviews_tab($tabs) {\n    $product_id = get_the_ID();\n    \n    \/\/ Solo mostrar si hay reviews\n    if (get_field('mql5_review_1_name', $product_id)) {\n        $total = get_field('mql5_total_reviews', $product_id) ?: 0;\n        $tabs['reviews']['title'] = sprintf('Reviews (%d)', $total);\n        $tabs['reviews']['callback'] = 'doittrading_mql5_reviews_content';\n    } else {\n        \/\/ Si no hay reviews, ocultar tab\n        unset($tabs['reviews']);\n    }\n    \n    return $tabs;\n}\n\nfunction doittrading_mql5_reviews_content() {\n    $product_id = get_the_ID();\n    $total_reviews = get_field('mql5_total_reviews', $product_id) ?: 0;\n    $avg_rating = get_field('mql5_average_rating', $product_id) ?: 5.0;\n    ?>\n    <div class=\"mql5-reviews\">\n        <div class=\"reviews-header\">\n            <h2>Verified Reviews from MQL5 Market<\/h2>\n            <div class=\"rating-summary\">\n                <span class=\"stars\"><?php echo str_repeat('\u2b50', round($avg_rating)); ?><\/span>\n                <span class=\"rating\"><?php echo number_format($avg_rating, 1); ?> out of 5<\/span>\n                <span class=\"count\">(<?php echo $total_reviews; ?> reviews)<\/span>\n            <\/div>\n        <\/div>\n        \n        <?php \n        \/\/ Mostrar hasta 5 reviews\n        for ($i = 1; $i <= 5; $i++):\n            $name = get_field('mql5_review_' . $i . '_name', $product_id);\n            if (!$name) continue; \/\/ Si no hay nombre, saltar\n            \n            $date = get_field('mql5_review_' . $i . '_date', $product_id);\n            $stars = get_field('mql5_review_' . $i . '_stars', $product_id);\n            $text = get_field('mql5_review_' . $i . '_text', $product_id);\n            ?>\n            \n            <div class=\"review-item\">\n                <div class=\"review-header\">\n                    <strong><?php echo esc_html($name); ?><\/strong>\n                    <span class=\"review-date\"><?php echo $date ? date('F j, Y', strtotime($date)) : ''; ?><\/span>\n                    <span class=\"stars\"><?php echo str_repeat('\u2b50', $stars); ?><\/span>\n                <\/div>\n                <p class=\"review-text\"><?php echo esc_html($text); ?><\/p>\n                <span class=\"verified-badge\">\u2713 Verified Purchase on MQL5<\/span>\n            <\/div>\n            \n        <?php endfor; ?>\n        \n        <?php \n        \/\/ Link a MQL5 si existe\n        $mql5_link = get_field('mql5_purchase_link_mt4', $product_id) ?: get_field('mql5_purchase_link_mt5', $product_id);\n        if ($mql5_link): ?>\n            <a href=\"<?php echo esc_url($mql5_link); ?>\" target=\"_blank\" class=\"view-all-reviews\">\n                View all <?php echo $total_reviews; ?> reviews on MQL5 Market \u2192\n            <\/a>\n        <?php endif; ?>\n    <\/div>\n    <?php\n}\n\n\/\/ A\u00f1adir schema markup para reviews\nadd_action('wp_head', 'doittrading_reviews_schema');\nfunction doittrading_reviews_schema() {\n    if (!is_product()) return;\n    \n    $product_id = get_the_ID();\n    $avg_rating = get_field('mql5_average_rating', $product_id);\n    $total_reviews = get_field('mql5_total_reviews', $product_id);\n    \n    if (!$avg_rating) return;\n    ?>\n    <script type=\"application\/ld+json\">\n    {\n        \"@context\": \"https:\/\/schema.org\/\",\n        \"@type\": \"Product\",\n        \"name\": \"<?php echo get_the_title(); ?>\",\n        \"aggregateRating\": {\n            \"@type\": \"AggregateRating\",\n            \"ratingValue\": \"<?php echo $avg_rating; ?>\",\n            \"reviewCount\": \"<?php echo $total_reviews; ?>\"\n        }\n    }\n    <\/script>\n    <?php\n}","active":true,"modified":"2025-07-18 20:46:35","revision":"3"}]}